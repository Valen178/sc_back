=== DOCUMENTACIÃ“N DEL PROYECTO ===

ğŸ“ back/
â”œâ”€â”€ ğŸ“„ .env (archivo de configuraciÃ³n)
â”‚   â””â”€â”€ Variables de entorno:
â”‚       - SUPABASE_URL
â”‚       - SUPABASE_ANON_KEY
â”‚       - PORT
â”‚       - JWT_SECRET
â”‚       - JWT_EXPIRES_IN
â”‚       - GOOGLE_CLIENT_ID
â”‚       - GOOGLE_CLIENT_SECRET
â”‚       - GOOGLE_CALLBACK_URL
â”‚
â”œâ”€â”€ ğŸ“„ .gitignore
â”‚   â””â”€â”€ Ignora:
â”‚       - node_modules
â”‚       - .env
â”‚
â”œâ”€â”€ ğŸ“„ package.json
â”‚   â””â”€â”€ Scripts:
â”‚       - "start": "node index.js"
â”‚       - "dev": "nodemon index.js"
â”‚
â”œâ”€â”€ ğŸ“„ index.js (Archivo principal)
â”‚   â””â”€â”€ ConfiguraciÃ³n:
â”‚       - Express
â”‚       - CORS
â”‚       - Middleware de seguridad
â”‚       - Rutas principales
â”‚       - Manejo de errores
â”‚
â”œâ”€â”€ ğŸ“ src/
â”‚   â”œâ”€â”€ ğŸ“ config/
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ controllers/
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ authController.js
â”‚   â”‚   â”‚   â””â”€â”€ Funciones:
â”‚   â”‚   â”‚       - signup (registro de usuario)
â”‚   â”‚   â”‚       - login (inicio de sesiÃ³n)
â”‚   â”‚   â”‚       - googleLogin (login con Google OAuth)
â”‚   â”‚   â”‚       - completeProfile (completar perfil de usuario)
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ adminController.js
â”‚   â”‚   â”‚   â””â”€â”€ Funciones:
â”‚   â”‚   â”‚       - getAllUsers (obtener todos los usuarios)
â”‚   â”‚   â”‚       - getUser (obtener usuario especÃ­fico)
â”‚   â”‚   â”‚       - updateUser (actualizar usuario)
â”‚   â”‚   â”‚       - deleteUser (eliminar usuario)
â”‚   â”‚   â”‚       - changeUserRole (cambiar rol de usuario)
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ lookupController.js
â”‚   â”‚   â”‚   â””â”€â”€ Funciones:
â”‚   â”‚   â”‚       - getAllSports (obtener todos los deportes)
â”‚   â”‚   â”‚       - getAllLocations (obtener todas las ubicaciones)
â”‚   â”‚   â”‚       - getLocationsByCountry (obtener ubicaciones por paÃ­s)
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ masterDataController.js
â”‚   â”‚   â”‚   â””â”€â”€ Funciones:
â”‚   â”‚   â”‚       - getAllSports, getSport, createSport, updateSport, deleteSport
â”‚   â”‚   â”‚       - getAllLocations, getLocation, createLocation, updateLocation, deleteLocation
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ postController.js
â”‚   â”‚   â”‚   â””â”€â”€ Funciones:
â”‚   â”‚   â”‚       - createPost (crear nueva publicaciÃ³n)
â”‚   â”‚   â”‚       - getAllPosts (listar todas las publicaciones)
â”‚   â”‚   â”‚       - getPost (obtener publicaciÃ³n especÃ­fica)
â”‚   â”‚   â”‚       - getUserPosts (obtener publicaciones de un usuario especÃ­fico)
â”‚   â”‚   â”‚       - deletePost (eliminar una publicaciÃ³n)
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ profileController.js
â”‚   â”‚   â”‚   â””â”€â”€ Funciones:
â”‚   â”‚   â”‚       - getMyProfile (obtener mi perfil)
â”‚   â”‚   â”‚       - updateProfile (actualizar perfil)
â”‚   â”‚   â”‚       - deleteMyProfile (eliminar mi perfil)
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ profilePhotoController.js
â”‚   â”‚   â”‚   â””â”€â”€ Funciones:
â”‚   â”‚   â”‚       - uploadProfilePhoto (subir foto de perfil)
â”‚   â”‚   â”‚       - deleteProfilePhoto (eliminar foto de perfil)
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ subscriptionController.js
â”‚   â”‚   â”‚   â””â”€â”€ Funciones:
â”‚   â”‚   â”‚       - getAllPlans (obtener todos los planes)
â”‚   â”‚   â”‚       - createPlan (crear plan)
â”‚   â”‚   â”‚       - deletePlan (eliminar plan)
â”‚   â”‚   â”‚       - getAllSubscriptions (obtener todas las suscripciones)
â”‚   â”‚   â”‚       - getSubscription (obtener suscripciÃ³n especÃ­fica)
â”‚   â”‚   â”‚       - updateSubscription (actualizar suscripciÃ³n)
â”‚   â”‚   â”‚       - deleteSubscription (eliminar suscripciÃ³n)
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ ğŸ“„ swipeController.js
â”‚   â”‚       â””â”€â”€ Funciones:
â”‚   â”‚           - createSwipe (dar like/dislike a usuario)
â”‚   â”‚           - getDiscoverUsers (obtener usuarios para descubrir)
â”‚   â”‚           - getUserMatches (obtener matches del usuario)
â”‚   â”‚           - getSwipeStats (obtener estadÃ­sticas de swipes)
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ middleware/
â”‚   â”‚   â””â”€â”€ ğŸ“„ auth.js
â”‚   â”‚       â””â”€â”€ Middlewares:
â”‚   â”‚           - verifyToken (verificar token JWT)
â”‚   â”‚           - isAdmin (verificar rol de administrador)
â”‚   â”‚           - canAccessResource (verificar acceso a recurso)
â”‚   â”‚
â”‚   â””â”€â”€ ğŸ“ routes/
â”‚       â”œâ”€â”€ ğŸ“„ authRoutes.js
â”‚       â”‚   â””â”€â”€ Rutas:
â”‚       â”‚       - POST /signup
â”‚       â”‚       - POST /login
â”‚       â”‚       - POST /google
â”‚       â”‚       - POST /complete-profile
â”‚       â”‚
â”‚       â”œâ”€â”€ ğŸ“„ adminRoutes.js
â”‚       â”‚   â””â”€â”€ Rutas:
â”‚       â”‚       - GET /users
â”‚       â”‚       - GET /users/:id
â”‚       â”‚       - PUT /users/:id
â”‚       â”‚       - DELETE /users/:id
â”‚       â”‚       - PATCH /users/:id/role
â”‚       â”‚       - GET /plans, POST /plans, DELETE /plans/:id
â”‚       â”‚       - GET /subscriptions, GET /subscriptions/:id
â”‚       â”‚       - PUT /subscriptions/:id, DELETE /subscriptions/:id
â”‚       â”‚       - GET /posts, GET /posts/:id, DELETE /posts/:id
â”‚       â”‚       - GET /sports, GET /sports/:id, POST /sports
â”‚       â”‚       - PUT /sports/:id, DELETE /sports/:id
â”‚       â”‚       - GET /locations, GET /locations/:id, POST /locations
â”‚       â”‚       - PUT /locations/:id, DELETE /locations/:id
â”‚       â”‚
â”‚       â”œâ”€â”€ ğŸ“„ lookupRoutes.js
â”‚       â”‚   â””â”€â”€ Rutas:
â”‚       â”‚       - GET /sports
â”‚       â”‚       - GET /locations
â”‚       â”‚       - GET /locations/country/:country
â”‚       â”‚
â”‚       â”œâ”€â”€ ğŸ“„ profileRoutes.js
â”‚       â”‚   â””â”€â”€ Rutas:
â”‚       â”‚       - GET /me
â”‚       â”‚       - PUT /me
â”‚       â”‚       - DELETE /me
â”‚       â”‚
â”‚       â”œâ”€â”€ ğŸ“„ postRoutes.js
â”‚       â”‚   â””â”€â”€ Rutas:
â”‚       â”‚       - POST /
â”‚       â”‚       - GET /
â”‚       â”‚       - GET /user/:userId
â”‚       â”‚       - DELETE /:postId
â”‚       â”‚
â”‚       â”œâ”€â”€ ğŸ“„ swipeRoutes.js
â”‚       â”‚   â””â”€â”€ Rutas:
â”‚       â”‚       - POST /
â”‚       â”‚       - GET /discover
â”‚       â”‚       - GET /matches
â”‚       â”‚       - GET /stats
â”‚       â”‚
â”‚       â””â”€â”€ ğŸ“„ profilePhotoRoutes.js
â”‚           â””â”€â”€ Rutas:
â”‚               - POST /upload
â”‚               - DELETE /delete

=== DEPENDENCIAS ===

Principales:
- express (framework web)
- cors (manejo de CORS)
- dotenv (variables de entorno)
- @supabase/supabase-js (cliente de Supabase)
- jsonwebtoken (tokens JWT)
- bcrypt (hash de contraseÃ±as)
- google-auth-library (autenticaciÃ³n con Google)
- multer (manejo de archivos multipart)

Desarrollo:
- nodemon (desarrollo con hot reload)
- axios (cliente HTTP)

=== TABLAS EN SUPABASE ===

1. users
   - id (int8, PK)
   - created_at (timestamptz)
   - email (varchar)
   - password (varchar)
   - role (text) ['user', 'admin']

2. athlete
   - id (int8, PK)
   - created_at (timestamptz)
   - name (varchar)
   - last_name (varchar)
   - birthdate (date)
   - height (int2)
   - weight (int2)
   - location_id (int8, FK â†’ location.id)
   - user_id (int8, FK â†’ users.id)
   - sport_id (int8, FK â†’ sport.id)
   - phone_number (text)
   - ig_user (text)
   - x_user (text)
   - description (text)
   - photo_url (varchar) - URL de la foto de perfil

3. agent
   - id (int8, PK)
   - created_at (timestamptz)
   - name (varchar)
   - last_name (varchar)
   - description (varchar)
   - user_id (int8, FK â†’ users.id)
   - location_id (int8, FK â†’ location.id)
   - sport_id (int8, FK â†’ sport.id)
   - phone_number (text)
   - ig_user (text)
   - x_user (text)
   - agency (text)
   - photo_url (varchar) - URL de la foto de perfil

4. team
   - id (int8, PK)
   - created_at (timestamptz)
   - name (varchar)
   - job (varchar)
   - description (varchar)
   - user_id (int8, FK â†’ users.id)
   - sport_id (int8, FK â†’ sport.id)
   - location_id (int8, FK â†’ location.id)
   - phone_number (text)
   - ig_user (text)
   - x_user (text)
   - photo_url (varchar) - URL de la foto de perfil

5. plan 
   - id (int8, PK)
   - created_at (timestamptz)
   - name (varchar)
   - price (int8)

6. subscription 
   - id (int8, PK)
   - created_at (timestamptz)
   - end_date (date)
   - user_id (int8, FK â†’ users.id)
   - plan_id (int8, FK â†’ plan.id)

7. match_state
   - id (int8, PK)
   - created_at (timestamptz)
   - state (varchar) ('active', 'expired', 'blocked')

8. match
   - id (int8, PK)
   - created_at (timestamptz)
   - match_state_id (int8, FK â†’ match_state.id)
   - user1_id (int8, FK â†’ users.id)
   - user2_id (int8, FK â†’ users.id)

9. chat
   - id (int8, PK)
   - created_at (timestamptz)
   - match_id (int8, FK â†’ match.id)

10. post
    - id (int8, PK)
    - created_at (timestamptz)
    - text (text)
    - url (varchar)
    - user_id (int8, FK â†’ users.id)

11. sport
    - id (int8, PK)
    - created_at (timestamptz)
    - name (varchar)

12. location
    - id (int8, PK)
    - created_at (timestamptz)
    - country (varchar)
    - province (varchar)
    - city (varchar)

13. swipes
      - id (int8, PK)
      - created_at (timestamptz)
      - swiper_user_id (int8, FK â†’ users.id)
      - swiped_user_id (int8, FK â†’ users.id)
      - action (varchar) ('like', 'dislike')

=== SEGURIDAD IMPLEMENTADA ===

1. AutenticaciÃ³n:
   - JWT para manejo de sesiones
   - Bcrypt para hash de contraseÃ±as
   - Google OAuth como alternativa de login

2. AutorizaciÃ³n:
   - Middleware de verificaciÃ³n de token
   - Middleware de verificaciÃ³n de rol admin
   - Middleware de verificaciÃ³n de acceso a recursos

3. Seguridad HTTP:
   - CORS configurado
   - Headers de seguridad bÃ¡sicos
   - Manejo de errores global

=== NOTAS ADICIONALES ===

- El proyecto usa el esquema 'public' de Supabase
- Los roles son 'user' y 'admin'
- athlete, agent y team son tipos de perfil para usuarios normales
- El manejo de permisos se hace principalmente desde el backend
- Incluye manejo de errores centralizado
- Preparado para desarrollo y producciÃ³n
